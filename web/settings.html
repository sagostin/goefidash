<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings ‚Äî Speeduino Dash</title>
    <link rel="stylesheet" href="settings.css">
</head>

<body>
    <div class="settings-page">
        <!-- Header -->
        <div class="settings-header">
            <a href="/" class="back-btn" id="btnBack">‚Üê Back</a>
            <h1>Settings</h1>
            <button class="save-btn" id="btnSave">Save</button>
        </div>

        <!-- Live Preview -->
        <div class="live-preview" id="livePreview">
            <span class="preview-item"><span class="preview-label">RPM</span> <span class="preview-val"
                    id="previewRPM">‚Äî</span></span>
            <span class="preview-item"><span class="preview-label">SPD</span> <span class="preview-val"
                    id="previewSpeed">‚Äî</span></span>
            <span class="preview-item"><span class="preview-label">GEAR</span> <span class="preview-val"
                    id="previewGear">‚Äî</span></span>
            <span class="preview-item"><span class="preview-label">~HP</span> <span class="preview-val"
                    id="previewHP">‚Äî</span></span>
        </div>

        <!-- Sections -->
        <div class="settings-body">

            <!-- Layout -->
            <div class="cfg-section">
                <h2>Display Layout</h2>
                <div class="cfg-row">
                    <label>Dashboard Style</label>
                    <select id="cfgLayout">
                        <option value="classic">Classic</option>
                        <option value="sweep">Sweep</option>
                        <option value="race">Race</option>
                        <option value="minimal">Minimal</option>
                    </select>
                </div>
            </div>

            <!-- Units -->
            <div class="cfg-section">
                <h2>Units</h2>
                <div class="cfg-row">
                    <label>Pressure</label>
                    <select id="cfgPressureUnit">
                        <option value="psi">PSI</option>
                        <option value="kpa">kPa</option>
                        <option value="bar">bar</option>
                    </select>
                </div>
                <div class="cfg-row">
                    <label>Speed</label>
                    <select id="cfgSpeedUnit">
                        <option value="kph">km/h</option>
                        <option value="mph">MPH</option>
                    </select>
                </div>
                <div class="cfg-row">
                    <label>Temperature</label>
                    <select id="cfgTempUnit">
                        <option value="C">¬∞C</option>
                        <option value="F">¬∞F</option>
                    </select>
                </div>
            </div>

            <!-- Warnings -->
            <div class="cfg-section">
                <h2>Warnings</h2>
                <div class="cfg-row">
                    <label>RPM Warn</label>
                    <input type="number" id="cfgRpmWarn" value="6000">
                </div>
                <div class="cfg-row">
                    <label>RPM Limit</label>
                    <input type="number" id="cfgRpmDanger" value="7000">
                </div>
                <div class="cfg-row">
                    <label>Oil Min (PSI)</label>
                    <input type="number" id="cfgOilWarn" value="15">
                </div>
                <div class="cfg-row">
                    <label>Knock Warn (¬∞)</label>
                    <input type="number" id="cfgKnockWarn" value="3">
                </div>
                <div class="cfg-row">
                    <label>CLT Warn (¬∞)</label>
                    <input type="number" id="cfgCltWarn" value="95">
                </div>
                <div class="cfg-row">
                    <label>CLT Danger (¬∞)</label>
                    <input type="number" id="cfgCltDanger" value="105">
                </div>
                <div class="cfg-row">
                    <label>IAT Warn (¬∞)</label>
                    <input type="number" id="cfgIatWarn" value="60">
                </div>
                <div class="cfg-row">
                    <label>IAT Danger (¬∞)</label>
                    <input type="number" id="cfgIatDanger" value="75">
                </div>
                <div class="cfg-row">
                    <label>Batt Low (V)</label>
                    <input type="number" id="cfgBattLow" value="12.0" step="0.1">
                </div>
                <div class="cfg-row">
                    <label>Batt High (V)</label>
                    <input type="number" id="cfgBattHigh" value="15.5" step="0.1">
                </div>
            </div>

            <!-- Drivetrain -->
            <div class="cfg-section">
                <h2>Drivetrain</h2>
                <div class="cfg-row">
                    <label>Show Gear</label>
                    <input type="checkbox" id="cfgShowGear" checked>
                </div>
                <div class="cfg-row">
                    <label>Final Drive</label>
                    <input type="number" step="0.01" id="cfgFinalDrive" value="3.73">
                </div>
                <div class="cfg-row">
                    <label>Tire Circ (m)</label>
                    <input type="number" step="0.01" id="cfgTireCircum" value="1.95">
                </div>
                <div class="cfg-row">
                    <label>Tolerance (%)</label>
                    <input type="number" id="cfgGearTolerance" value="15" min="5" max="30">
                </div>
                <div class="gear-section">
                    <div class="gear-header">Gear Ratios</div>

                    <!-- Collapsible Instructions -->
                    <button class="gear-instructions-toggle" id="gearInstructionsToggle">
                        üìñ How to Learn Gear Ratios
                    </button>
                    <div class="gear-instructions-body" id="gearInstructionsBody">
                        <ol>
                            <li>Set your <strong>Final Drive</strong> and <strong>Tire Circumference</strong> above
                                first</li>
                            <li>Drive in the gear you want to learn</li>
                            <li>Hold <strong>steady speed at 2,000‚Äì3,000 RPM</strong> ‚Äî no acceleration or braking</li>
                            <li>Press <strong>Learn</strong> ‚Äî the system samples 10 frames and averages the ratio</li>
                            <li>Repeat for each gear, or learn one and press <strong>Auto-Fill</strong> to estimate the
                                rest</li>
                        </ol>
                        <p class="gear-tip">üí° 3rd or 4th gear is easiest to hold steady. Learn one gear and Auto-Fill
                            will extrapolate the others using a geometric progression.</p>
                    </div>

                    <div id="gearRatioList"></div>

                    <!-- Auto-Fill from known gear -->
                    <button class="gear-autofill-btn" id="btnAutoFill"
                        title="Estimate empty gears from any learned gear">
                        ‚ö° Auto-Fill Remaining Gears
                    </button>
                </div>
            </div>

            <!-- Vehicle Physics -->
            <div class="cfg-section">
                <h2>Vehicle Physics <span class="section-hint">For ~HP estimation</span></h2>
                <div class="cfg-row">
                    <label>Mass (kg)</label>
                    <input type="number" step="10" id="cfgVehicleMass" value="1200">
                </div>
                <div class="cfg-row">
                    <label>Drag Coeff (Cd)</label>
                    <input type="number" step="0.01" id="cfgDragCoeff" value="0.32">
                </div>
                <div class="cfg-row">
                    <label>Frontal Area (m¬≤)</label>
                    <input type="number" step="0.1" id="cfgFrontalArea" value="2.2">
                </div>
                <div class="cfg-row">
                    <label>Rolling Resist</label>
                    <input type="number" step="0.001" id="cfgRollingResist" value="0.012">
                </div>
            </div>

            <!-- Connection -->
            <div class="cfg-section">
                <h2>Connection</h2>
                <div class="cfg-row">
                    <label>ECU Type</label>
                    <select id="cfgEcuType">
                        <option value="speeduino">Speeduino</option>
                        <option value="demo">Demo</option>
                    </select>
                </div>
                <div class="cfg-row">
                    <label>GPS Type</label>
                    <select id="cfgGpsType">
                        <option value="nmea">NMEA</option>
                        <option value="demo">Demo</option>
                        <option value="disabled">Off</option>
                    </select>
                </div>
            </div>

        </div>

        <!-- Bottom Save -->
        <div class="settings-footer">
            <button class="save-btn-lg" id="btnSaveBottom">Save & Return</button>
        </div>
    </div>

    <script src="shared.js"></script>
    <script src="settings.js"></script>
</body>

</html>